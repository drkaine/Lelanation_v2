// Lelanation stats: matches and participants (Ranked Solo/Duo, EUW/EUNE)
// See epic-lol-statistics-platform.md

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Match {
  id            BigInt   @id @default(autoincrement())
  matchId       String   @unique @map("match_id")
  region        String   // euw1, eun1
  queueId       Int      @map("queue_id") // 420 = Ranked Solo/Duo
  gameVersion   String?  @map("game_version")
  gameDuration  Int?     @map("game_duration")
  platformId    String?  @map("platform_id")
  rank          String?  // average rank of players in the match, e.g. "GOLD_II"
  createdAt     DateTime @default(now()) @map("created_at")

  participants Participant[]

  @@map("matches")
}

model Participant {
  id              BigInt   @id @default(autoincrement())
  matchId         BigInt   @map("match_id")
  puuid           String
  championId      Int      @map("champion_id")
  win             Boolean
  role            String?  // TOP, JUNGLE, MIDDLE, BOTTOM, UTILITY
  teamPosition    String?  @map("team_position")
  rankTier        String?  @map("rank_tier")
  rankDivision    String?  @map("rank_division")
  rankLp          Int?     @map("rank_lp")
  items           Json?    // [item_id, ...]
  runes           Json?
  summonerSpells Json?     @map("summoner_spells")
  kills           Int      @default(0)
  deaths          Int      @default(0)
  assists         Int      @default(0)
  createdAt       DateTime @default(now()) @map("created_at")

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([puuid])
  @@index([championId])
  @@index([rankTier])
  @@index([role])
  @@index([championId, rankTier])
  @@map("participants")
}

model Player {
  puuid              String    @id
  summonerId         String?   @map("summoner_id")
  summonerName       String?   @map("summoner_name")
  region             String
  totalGames         Int       @default(0) @map("total_games")
  totalWins          Int       @default(0) @map("total_wins")
  lastSeen           DateTime? @map("last_seen")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  @@index([region])
  @@index([lastSeen])
  @@map("players")
}

